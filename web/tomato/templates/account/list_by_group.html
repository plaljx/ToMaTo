{% extends "base.html" %}
{% load i18n %}

{% load url from future %}
{% load tomato %}


{% block title %}
<title>{%trans 'User Accounts'%} - ProviSec Testbed</title>
{% endblock %}


{% block content %}


<h1>{%trans 'User Accounts'%}</h1>
<h2>{%trans 'Group:'%}{{ group.name }}</h2>
{#<h3>{%trans 'Role:'%}{{ role }}</h3>#}

<div class="btn-group">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
    <span class="glyphicon glyphicon-filter"></span>
    {% if role %}
      {% trans 'Showing '%} {{ role }} {% trans ' accounts' %}
    {% else %}
      {% trans 'Showing all accounts' %}
    {% endif %}
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" role="menu">
    <li><a href="{% url "group_accounts_all" group=group.name %}">{%trans 'Show all accounts'%}</a></li>
    <li class="divider"></li>
    <li class="dropdown-header">{%trans "Role"%}</li>
    <li><a href="{% url "group_accounts" group=group.name role="owner" %}">{%trans 'Owner'%}</a></li>
    <li><a href="{% url "group_accounts" group=group.name role="manager" %}">{%trans 'Manager'%}</a></li>
    <li><a href="{% url "group_accounts" group=group.name role="user" %}">{%trans 'User'%}</a></li>
    <li><a href="{% url "group_accounts" group=group.name role="invited" %}">{% trans 'Invited' %}</a></li>
    <li><a href="{% url "group_accounts" group=group.name role="applying" %}">{% trans 'Applying' %}</a></li>
  </ul>
</div>

<div class="skip-sm"></div>

<script src="/js/enhancetable.js"></script>
{% if accounts %}
<table class="sortable,filterable table table-striped">
  <tr>
    <th>{%trans 'Name'%}</th>
    <th>{%trans 'Origin'%}</th>
    <th>{%trans 'Full name'%}</th>
    <th>{%trans 'Organization'%}</th>
    <th>{%trans 'Role'%}</th>
    <th>{%trans 'Flags'%}</th>
    <th>{% trans "Operations" %}</th>
  </tr>
{% for account in accounts %}
  <tr>
    <td>
      {% if "new_account" in account.flags %}
      <span class="glyphicon glyphicon-question-sign" title="New account"></span>
      {% else %}{% if "global_admin" in account.flags or "global_topl_admin" in account.flags or "global_host_manager" in account.flags %}
      <span class="glyphicon glyphicon-star" title="Account with global permissions"></span>
      {% else %}{% if "orga_admin" in account.flags or "orga_topl_admin" in account.flags or "orga_host_manager" in account.flags %}
      <span class="glyphicon glyphicon-star-empty" title="Account with organization-wide permissions"></span>
      {% else %}
      <span class="glyphicon glyphicon-user" title="Regular user"></span>
      {% endif %}{% endif %}{% endif %}
      <a href="{%url "account.info" account.name%}">{{account.name}}</a>
    </td>
    <td>{{account.origin}}</td>
    <td>{{account.realname}}</td>
    <td>{{account.organization}}</td>
    <td>{{account.role}}</td>
    <td>
        <div class="hoverdescription" style="white-space:normal">
            {{account.flags|join:", "}}
            <div class="hiddenbox">
                {{account.flags_name }}
            </div>
        </div>
    </td>
    <td>
        <div>
            {% if account.role == 'applying' %}
                <a class="btn btn-xs btn-primary" role="button"
                    href="{% url "group_handle_application" user=account.name group=group.name operation='accept' %}">
                    <span class="glyphicon glyphicon-ok"></span>{% trans 'Accept' %}
                </a>
                <a class="btn btn-xs btn-warning" role="button"
                    href="{% url "group_handle_application" user=account.name group=group.name operation='decline' %}">
                    <span class="glyphicon glyphicon-remove"></span>{% trans 'Decline' %}
                </a>
            {% endif %}
            {# TODO: may change this to the entry of edit page #}
            {% if request.session.user.isGlobalAdmin %}
                <a class="btn btn-xs btn-danger" role="button"
                   href="{% url "group_account_remove" user=account.name group=group.name%}">
                    <span class="glyphicon glyphicon-remove"></span>{% trans 'Remove' %}
                </a>
            {% endif %}
        </div>
    </td>
  </tr>
{% endfor %}
</table>
{% else %}

<p>{%trans 'There are no adequate accounts yet.'%}</p>

{% endif %}

<form>
    {# Set Account #}
    {% if request.session.user.isGlobalAdmin %}
    <button type="submit" formaction="{% url "group_account_add" group.name%}" class="btn btn-success">
        <span class="glyphicon glyphicon-plus"></span>
        {% trans "Set Account" %}
    </button>
    {% endif %}

    {# Invite #}
    {% if request.session.user.isGlobalAdmin or role == "owner" or role == "manager" %}
        <button type="submit" formaction="{%url "group_account_invite" group.name%}" class="btn btn-primary">
            <span class="glyphicon glyphicon-send"></span>
            {% trans 'Invite User' %}
        </button>
    {% endif %}
</form>

{% endblock %}
