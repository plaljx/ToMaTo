from ...security_resources.vulnerability import Vulnerability
from ...lib.error import UserError
from ...lib.exceptionhandling import wrap_errors


@wrap_errors(errorcls_func=lambda e: UserError, errorcode=UserError.ENTITY_DOES_NOT_EXIST)
def _get_vulnerability(id_):
    res = Vulnerability.objects.get(id=id_)
    UserError.check(res, code=UserError.ENTITY_DOES_NOT_EXIST, message="SecuritySoftware does not exist", data={"id": id_})
    return res


def vulnerability_list():
    res_list = Vulnerability.objects()
    return [res.info() for res in res_list]


def vulnerability_create(attrs=None):
    if not attrs:
        attrs = {}
    attrs = dict(attrs)
    res = Vulnerability.create(**attrs)
    return res.info()


def vulnerability_modify(id_, attrs=None):
    res = _get_vulnerability(id_)
    res.modify(**attrs)
    return res.info()


def vulnerability_remove(id_):
    res = _get_vulnerability(id_)
    res.remove()
    return {}


def vulnerability_info(id_):
    res = _get_vulnerability(id_)
    return res.info()

